<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src {{CSP_SOURCE}} https: data:; style-src {{CSP_SOURCE}}; script-src 'nonce-{{NONCE}}' {{CSP_SOURCE}}; font-src {{CSP_SOURCE}} https: data:;">
    <meta name="color-scheme" content="light dark">
    <title>Discovery Lens</title>
    <link href="{{STYLE_URI}}" rel="stylesheet">
</head>
<body>
    <div class="container glass-surface">
        <header class="hero">
            <div class="hero-content">
                <h1>Discovery Lens</h1>
                <p class="subtitle">Visualize adaptive discovery with Tahoe-inspired liquid glass styling.</p>
            </div>
        </header>

        <main class="layout">
            <section class="card input-section" aria-labelledby="input-heading">
                <h2 id="input-heading" class="visually-hidden">Discovery Configuration</h2>

                <label for="signature-input">Discovery Signature (JSON)</label>
                <textarea
                    id="signature-input"
                    placeholder='{"name": "Calculator", "type": "class", "methods": ["add", "subtract"]}'
                    rows="4"
                    aria-describedby="signature-help"
                    aria-required="true"
                ></textarea>
                <div id="signature-help" class="visually-hidden">
                    Enter a JSON object with a name property and optional type and methods properties to discover matching code
                </div>

                <fieldset class="preset-buttons" role="group" aria-labelledby="preset-legend">
                    <legend id="preset-legend" class="visually-hidden">Preset Examples</legend>
                    <button class="preset-btn" data-preset="class" aria-describedby="class-desc">
                        Class Example
                    </button>
                    <button class="preset-btn" data-preset="function" aria-describedby="function-desc">
                        Function Example
                    </button>
                    <button class="preset-btn" data-preset="interface" aria-describedby="interface-desc">
                        Interface Example
                    </button>
                    <div class="preset-descriptions">
                        <div id="class-desc" class="visually-hidden">Load example signature for class discovery</div>
                        <div id="function-desc" class="visually-hidden">Load example signature for function discovery</div>
                        <div id="interface-desc" class="visually-hidden">Load example signature for interface discovery</div>
                    </div>
                </fieldset>

                <button id="run-discovery" class="primary-btn" aria-describedby="run-help">
                    <span class="primary-btn__icon" aria-hidden="true">üöÄ</span>
                    <span>Run Discovery</span>
                </button>
                <div id="run-help" class="visually-hidden">
                    Run discovery to find matching code files. Use Ctrl+Enter as a keyboard shortcut.
                </div>
            </section>

            <div class="card discovery-progress hidden" role="status" aria-labelledby="progress-text" data-display="flex">
                <div class="progress-indicator">
                    <span class="progress-spinner" aria-hidden="true"></span>
                    <span id="progress-text">Discovering files...</span>
                </div>
                <div class="progress-steps" aria-hidden="true">
                    <div class="progress-step" data-step="scan"></div>
                    <div class="progress-step" data-step="parse"></div>
                    <div class="progress-step" data-step="score"></div>
                    <div class="progress-step" data-step="complete"></div>
                </div>
            </div>

            <section class="card results-section hidden" aria-labelledby="results-heading">
                <h2 id="results-heading">Discovery Results</h2>
                <div class="results-summary" role="status" aria-live="polite" aria-atomic="true"></div>
                <div id="status-announcements" aria-live="assertive" aria-atomic="true" class="visually-hidden"></div>
                <div id="results-container" role="list" aria-labelledby="results-heading"></div>
            </section>

            <section class="card error-section hidden" role="alert" aria-labelledby="error-heading">
                <h2 id="error-heading" class="visually-hidden">Error</h2>
                <div class="error-content">
                    <div class="error-icon" aria-hidden="true">‚ö†Ô∏è</div>
                    <div class="error-details">
                        <div class="error-category" id="error-category"></div>
                        <div class="error-message" aria-describedby="error-help"></div>
                        <div class="error-description" id="error-description"></div>
                        <div class="error-actions" id="error-actions"></div>
                    </div>
                </div>
                <div id="error-help" class="visually-hidden">
                    An error occurred during discovery. Please check your signature syntax and try again.
                </div>
            </section>

            <section class="card help-section" aria-labelledby="help-heading">
                <details>
                    <summary id="help-heading" aria-expanded="false" aria-controls="help-content">
                        How Discovery Works
                    </summary>
                    <div id="help-content" class="help-content">
                        <p>The discovery engine uses multiple strategies to find your code:</p>
                        <ul role="list">
                            <li role="listitem"><strong>Name Matching:</strong> Searches for files and exports matching the signature name</li>
                            <li role="listitem"><strong>Type Analysis:</strong> Matches based on code structure (class, function, interface)</li>
                            <li role="listitem"><strong>Method Signatures:</strong> Compares available methods with expected ones</li>
                            <li role="listitem"><strong>Path Scoring:</strong> Prefers standard locations (src/, lib/, etc.)</li>
                            <li role="listitem"><strong>AST Analysis:</strong> Deep code structure analysis for accurate matching</li>
                        </ul>
                        <p>Each candidate receives a score based on how well it matches the signature. Higher scores indicate better matches.</p>
                    </div>
                </details>
            </section>
        </main>
    </div>

    <script type="module" nonce="{{NONCE}}">
        import "{{SCRIPT_URI}}";
    </script>
</body>
</html>
